================================================================================
  SOVEREIGN ACADEMY â€” FILE & FOLDER REFERENCE GUIDE
  Every file explained. Written for the project owner.
================================================================================

  Version: February 2026
  Author:  AI Pair Programmer (Antigravity)
  Purpose: Explain what every single file and folder does, in plain language.

  For the conceptual overview (how layers work together), see:
    docs/project_overview.txt

================================================================================
  ROOT DIRECTORY FILES
================================================================================

  deno.json
  â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The master configuration file for this project.
  Deno reads this file every time you run any command.
  It controls:
    â€¢ "imports" â€” Where to fetch libraries from (Preact, Fresh, Vitest, etc.)
    â€¢ "tasks"   â€” All the shortcut commands like "deno task verify"
    â€¢ "lint"    â€” Which code quality rules to enforce
    â€¢ "fmt"     â€” Code formatting settings (2-space indent, 100 char line width)
    â€¢ "exclude" â€” Folders to ignore during lint/check (node_modules, _fresh, target/)
  Think of it like package.json in a Node.js project, but for Deno.

  deno.lock
  â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A lock file automatically generated by Deno.
  Records the exact version and checksum of every downloaded library.
  Ensures that everyone on the team uses the exact same library versions.
  DO NOT edit this manually â€” Deno manages it automatically.

  package.json / package-lock.json
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  npm configuration files. Exist because some tools (Vitest, Playwright)
  still rely on npm's node_modules system.
  Deno uses these through its "nodeModulesDir: auto" compatibility mode.
  You don't interact with these files directly.

  main.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The entry point for the Deno server in production.
  When you run "deno task start", Deno executes this file.
  It calls Fresh's serve() function to start accepting HTTP requests.

  utils.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A single tiny file that exports the "define" helper from Fresh.
  Used by all routes to ensure type-safe page handlers.
  Example usage in routes: import { define } from "@/utils.ts"

  client.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Called by Fresh in the browser (client-side entry point).
  Mounts the Preact application in the browser after server-side rendering.

  vite.config.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Configuration for Vite (the build tool and dev server inside Fresh).
  Sets up:
    â€¢ MDX plugin  â€” Allows writing lesson content in .mdx files
    â€¢ KaTeX       â€” Renders math formulas (e.g., âˆ‘, âˆ«, âˆš)
    â€¢ remark-math â€” Parses math syntax in markdown ($$...$$)
  This is how you get beautiful math equations in your lesson pages.

  vitest.config.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Configuration for Vitest (the unit test runner).
  Tells Vitest where to find test files (lib/*.test.ts).
  Sets the test environment to "jsdom" (simulates a browser for tests).
  Run with: deno task test:unit

  playwright.config.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Configuration for Playwright (the end-to-end test runner).
  Tells Playwright which browser to use and where the app runs.
  Run with: deno task test:e2e

  biome.json
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Configuration for Biome (an alternative code formatter/linter).
  Currently installed but not part of the main "verify" pipeline.
  Can be run with: deno task biome:check
  Useful as a second opinion on code quality.

  fresh_llm.txt
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A reference document about how the Fresh 2.x framework works.
  Written for AI coding agents (like the one helping you now).
  Contains patterns, API examples, and best practices.

  antigravity_llm.txt
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A reference document explaining the Antigravity AI agent system.
  Written so the AI assistant understands the project's workflow standards.

  GEMINI.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The AI agent's "constitution" for this project.
  Every time a new conversation starts, the AI reads this file first.
  Defines: project identity, frozen core rules, state management rules,
           zero useState policy, and which skills to use.

  README.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The main project description shown on GitHub.
  Contains: architecture diagram, quick start guide, task commands, and
            the Frozen Core policy explanation.

  CHANGELOG.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A history of major changes and phases completed.
  Read this to understand what was built in each phase.

  file.todo
  â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The SINGLE SOURCE OF TRUTH for the project roadmap.
  Every feature, bug fix, and milestone is tracked here.
  Format: [x] = done, [ ] = still to do.
  This is the most important planning document in the project.

  .editorconfig
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Tells code editors (VSCode, etc.) how to format files automatically.
  Enforces: 2-space indent, LF line endings, UTF-8, no trailing whitespace.
  Ensures consistency even if different developers use different editors.

  .gitattributes
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Tells Git how to handle different file types.
  Key rules: .wasm and .bin files are "binary" (don't try to diff them).
             .ts, .tsx, .rs files are "text" with LF line endings.
  Prevents corruption when sharing code between Windows and Mac.

  .gitignore
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Tells Git which files and folders to NEVER track.
  Key exclusions: node_modules/, _fresh/, target/, *.timestamp-*, deno.lock (NO â€” lock IS tracked).


================================================================================
  islands/  â† INTERACTIVE UI COMPONENTS
================================================================================

  What "islands" means:
    In Fresh, an "island" is a component that runs in the BROWSER.
    Everything else in Fresh is server-rendered (runs on the server, sends HTML).
    Islands are the interactive parts â€” they respond to clicks, update in real time.

  islands/TitleBar.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The custom title bar at the top of the window.
  It replaces the normal OS title bar (which is hidden in this app).
  What it does:
    â€¢ Shows the app name "Sovereign Academy"
    â€¢ Has three buttons: Minimize (â€”), Maximize (â–¡), Close (âœ•)
    â€¢ The entire bar is draggable (you grab it to move the window)
    â€¢ Buttons call POST /api/window/[action] to control the native Rust window
    â€¢ Detects if the window is maximized and adds 8px padding to prevent clipping
  CSS trick: position:sticky so it NEVER scrolls out of view.

  islands/Sidebar.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The left panel â€” the Discord-style "channel list" of math topics.
  What it does:
    â€¢ Shows all 19 math topics as clickable channel items
    â€¢ Highlights the currently selected topic
    â€¢ Shows a completion badge (%) next to each topic
    â€¢ Shows a global progress bar at the top
    â€¢ Has a user area at the bottom with an avatar
    â€¢ Can collapse on small screens (mobile)
  When clicked: calls selectTopic(id) which updates the global signal,
                which causes MathStage to reload with the new topic.

  islands/MathStage.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The main learning area â€” the biggest and most important component.
  What it does:
    â€¢ Shows the current topic name as a heading
    â€¢ Loads and displays exercise cards (math problems)
    â€¢ Loads the WASM math engine and runs a health check on startup
    â€¢ Accepts student answers via a text input
    â€¢ Sends the answer to WASM for validation on "Check Answer" click
    â€¢ Shows green âœ“ (correct) or red âœ— + hint (incorrect)
    â€¢ Tracks streak counter with ğŸ”¥ animation
    â€¢ Auto-advances to the next exercise after 1.5 seconds on correct answer
    â€¢ Can also show lesson text or the VolumeSimulator component
  Size: ~345 lines. This is the heart of the learning experience.

  islands/LessonToc.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The right sidebar â€” Table of Contents for lesson pages.
  What it does:
    â€¢ Reads the lesson's headings and shows them as navigation links
    â€¢ When a link is clicked, smoothly scrolls to that section in the lesson
    â€¢ Uses manual scroll calculation (offsetTop) instead of scrollIntoView()
      IMPORTANT: scrollIntoView() would scroll the whole page and HIDE the
      TitleBar. The manual approach prevents that bug.
    â€¢ Shows "Related Topics" links at the bottom

  islands/LessonSheet.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A slide-out sheet (drawer) that shows a lesson's content panel.
  Appears on top of the main content when a lesson button is clicked.
  Used for displaying formatted lesson text within the exercise flow.

  islands/VolumeSimulator.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  An interactive 3D geometry learning tool.
  What it does:
    â€¢ Draws 3D shapes (Cube, Rectangular Prism, Square Pyramid) as SVG
    â€¢ You can slide sliders to change length, width, height in real time
    â€¢ The shape re-draws instantly. Volume and surface area update instantly.
    â€¢ Shows the mathematical formula for the selected shape
    â€¢ Has a "net view" â€” unfolds the shape flat to show all its faces
  Size: ~430 lines. Uses pure TypeScript math, no external library.


================================================================================
  routes/  â† WEB SERVER PAGES & APIs
================================================================================

  What "routes" means:
    Routes are the URL pages of the app.
    You type a URL â†’ Fresh finds the matching route â†’ it renders that page.

  routes/_app.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The master HTML wrapper for EVERY page in the app.
  Adds: <html>, <head>, <meta tags>, <link to discord.css>, <body>.
  Every route renders INSIDE this wrapper.
  The body gets class="discord-app" which activates the dark Discord theme.

  routes/_404.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The "page not found" page.
  Shows a styled error message when you access a URL that doesn't exist.

  routes/index.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The main "/" page (the home page).
  Assembles the full app layout:
    TitleBar  (top)
    Sidebar   (left)
    MathStage (center)
    LessonToc (right)
  This is a thin file â€” it just puts the pieces together.

  routes/geometry.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A page at "/geometry" that shows the VolumeSimulator on its own.
  A standalone page for just the 3D geometry exploration tool.

  routes/lesson/[...slug].tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A wildcard route that serves any MDX lesson file.
  The "[...slug]" means it matches ANY path after "/lesson/".
  Example: /lesson/lesson-demo â†’ loads content/lesson-demo.mdx
  Example: /lesson/fractions/adding â†’ loads content/fractions/adding.mdx
  It imports the MDX module dynamically and renders it with KaTeX math support.

  routes/lesson/T11_6_0_EN.tsx
  routes/lesson/T11_6_0_TH.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Specific lesson pages for Topic 11 (Square Roots), Level 6.0.
  EN = English version, TH = Thai version.
  These are hardcoded lesson pages (not dynamic MDX routes).
  Contains lesson text, formulas, and links to exercises.

  routes/lesson/cube-scaling.tsx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A specific lesson page about cube scaling and volume relationships.
  Contains lesson content explaining how volume changes when you scale a cube.

  routes/api/manifest.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  REST API endpoint at GET /api/manifest
  Returns a JSON list of all 19 topics and the paths to their .bin exercise files.
  The MathStage component fetches this on startup to know what exercises exist.
  Returns Cache-Control: max-age=86400 (cached for 24 hours).

  routes/api/window/[action].ts  (inside routes/api/window/ folder)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  REST API endpoint at POST /api/window/minimize|maximize|close
  Called by the TitleBar buttons to control the native Rust window.
  Example: TitleBar "close" button â†’ POST /api/window/close â†’ Rust closes window.

  routes/api/lesson/  (folder)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  API routes for lesson-related data fetching.
  Used by lesson pages to load content or exercise data.


================================================================================
  lib/  â† PURE TYPESCRIPT UTILITY FUNCTIONS
================================================================================

  What "lib" means:
    Pure utility functions with NO UI code.
    These are the "business logic" of the app.
    Every file here has tests (the *.test.ts files).

  lib/state.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The global application state. THE most important lib file.
  Uses Preact Signals (a reactive state system) instead of React's useState.
  Contains:
    â€¢ TOPICS array â€” All 19 math topics with their subtopics (the curriculum data)
    â€¢ activeTopic signal â€” Which topic (1-19) is currently selected
    â€¢ currentExercise signal â€” The exercise being displayed
    â€¢ studentAnswer signal â€” What the student typed
    â€¢ lastResult signal â€” Was the last answer correct?
    â€¢ progress signal â€” How many exercises completed per topic
    â€¢ isMaximized signal â€” Is the window maximized?
    â€¢ selectTopic() â€” Action to change topic
    â€¢ markCompleted() â€” Action to record a correct answer
  All islands read from and write to these signals.

  lib/state.test.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  29 unit tests for lib/state.ts.
  Tests: selectTopic resets state, markCompleted increments progress,
         computed signals update correctly, etc.

  lib/exercise-loader.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Fetches and parses binary (.bin) exercise files from the server.
  The binary format is a compact custom protocol:
    Byte 0: Exercise type (1=arithmetic, 2=fraction, 3=equation)
    Bytes 1-2: Problem string length
    Bytes 3+: Problem string (UTF-8 text)
    ... then same for answer string
  Has an in-memory cache so the same file is never fetched twice.
  Falls back to a demo exercise generator if no .bin file exists.

  lib/exercise-loader.test.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  18 unit tests for the exercise loader.
  Tests: binary parsing, cache behavior, demo generation, edge cases.

  lib/validation.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Input validation helpers for form fields.
  Checks: Is the input a valid number? Is it within range? Is it empty?
  Does NOT do math checking â€” that is the WASM engine's job.

  lib/validation.test.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  12 unit tests for validation.ts.

  lib/wasm-health-check.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Runs 3 quick sanity tests against the WASM math engine at startup:
    1+1 = 2  âœ“
    2*3 = 6  âœ“
    4/2 = 2  âœ“
  If any fail, returns a warning status.
  MathStage shows a red banner if health check fails.
  This catches WASM loading errors, corruption, or initialization bugs.

  lib/wasm-health-check.test.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  11 unit tests for the health check system.

  lib/wasm-loader.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Handles the process of loading the .wasm file in the browser.
  Fetches the .wasm binary, initializes the WASM module, and returns the API.
  Uses Blob URLs and dynamic import() to load WASM without build-time issues.

  lib/native.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The Deno FFI (Foreign Function Interface) bridge to the Rust native library.
  Loads native_window.dll (Windows) / .dylib (Mac) / .so (Linux).
  Exports: create_frameless_window, minimize, maximize, close, setTitle, etc.
  Has graceful fallback if running in browser mode (no native library).

  lib/schemas.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Zod schema definitions for data validation.
  Defines the shape of: Exercise, Topic, ValidationResult objects.
  Zod gives runtime type safety (not just TypeScript compile-time).

  lib/types.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Shared TypeScript type definitions.
  Exports interfaces and types used across multiple files.

  lib/msgpack-loader.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A small utility to decode MessagePack binary format.
  MessagePack is a compact binary alternative to JSON.
  Used for loading exercise data in the MessagePack format.


================================================================================
  math-engine/  â† RUST MATH VALIDATION ENGINE
================================================================================

  This entire folder is a Rust library that compiles to WebAssembly.
  STATUS: FROZEN CORE â€” test before modifying.

  math-engine/Cargo.toml
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Rust project manifest. Like package.json but for Rust/Cargo.
  Declares: project name, dependencies (wasm-bindgen), and WASM optimizations.
  Key settings: opt-level="z" (minimize size), lto=true (link-time optimization).

  math-engine/Cargo.lock
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Auto-generated. Locks exact versions of every Rust dependency.
  DO NOT edit manually.

  math-engine/src/lib.rs
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The actual math engine code.
  Exports 6 functions to JavaScript via wasm-bindgen:
    â€¢ validate_arithmetic(expr, answer) â†’ checks arithmetic expressions
    â€¢ validate_equation(expr, answer)   â†’ checks equations with variables
    â€¢ validate_fraction(a, b)           â†’ compares fractions without floats
    â€¢ simplify_fraction(n, d)           â†’ reduces fraction to lowest terms
    â€¢ check_answer(type, problem, ans)  â†’ master router, returns JSON
    â€¢ batch_validate(exprs, answers)    â†’ validates many answers at once
  Contains 9 built-in unit tests (run with: deno task test:rust).

  math-engine/tests/purity_test.rs
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  22 purity/determinism tests for the math engine.
  Each test calls a math function 100 times and checks the result is ALWAYS the same.
  Purpose: Prove the math engine has no hidden state, randomness, or side effects.
  This is the "Pillar 2" of Anti-Logic Drift: Same Input â†’ Same Output.


================================================================================
  desktop/  â† RUST NATIVE WINDOW SHELL
================================================================================

  STATUS: FROZEN CORE â€” Never modify without a full regression test plan.

  desktop/Cargo.toml
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Rust manifest for the desktop shell.
  Dependencies: tao (window management), wry (WebView/web engine embedding).

  desktop/src/main.rs
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The entire native desktop application. ALL window behavior is here.
  What it does:
    â€¢ Creates a frameless window using the tao crate
    â€¢ Embeds a WebView (wry) that loads http://localhost:5173
    â€¢ Handles Win32 messages for resize, drag, min/max/close
    â€¢ WM_NCHITTEST: Defines which window area responds to drag vs resize
    â€¢ DwmExtendFrameIntoClientArea: Extends the shadow under the frameless window
    â€¢ Injects JavaScript for the 8-direction resize handles
  Build output: desktop/target/release/sovereign.exe

  desktop/README.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Explains the Frozen Core policy for this folder.
  Documents WHY it's frozen and what tests to run if you must change it.


================================================================================
  static/  â† STATIC ASSETS (served directly to browser, no processing)
================================================================================

  static/discord.css
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The CSS entry point. Only contains @import statements.
  Imports all the modular CSS files from static/css/.
  Why this exists: _app.tsx links to this one file, and it loads everything.

  static/css/base.css
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The CSS foundation. Contains the :root block with ALL design tokens.
  Every color, font, spacing, and timing value is defined here as a variable.
  Example: --bg-sidebar: #2b2d31  (the Discord dark sidebar gray)
  All other CSS files use var(--...) instead of hardcoded values.
  This is the ONLY file the CSS snapshot system monitors for drift.

  static/css/layout.css
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Layout rules for the application shell structure.
  Controls: .discord-app, .app-shell, .app-body, .title-bar, .sidebar(.collapsed).
  The three-column layout (Sidebar + MathStage + LessonToc) is defined here.

  static/css/components.css
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Styles for shared, reusable UI elements.
  Contains: toggle buttons, mode buttons, language switcher, 404 error page.

  static/css/modules/math-stage.css
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Styles specific to the main learning area (MathStage island).
  Contains: stage header, WASM badge, exercise card, answer input, streak counter,
            loading spinner, correct/incorrect result display.

  static/css/modules/lesson.css
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Styles for lesson content rendered from Markdown/MDX.
  Contains: headings (h1-h6), paragraphs, lists, code blocks, tables, blockquotes.
  Also includes: KaTeX math formula overrides (for beautiful math rendering).

  static/css/modules/lesson-toc.css
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Styles for the right-side Table of Contents panel.
  Contains: TOC heading, list links, active-link highlighting, related topics section.

  static/css/modules/simulator.css
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Styles for the VolumeSimulator island.
  Contains: simulator layout, SVG viewport, shape legend, slider controls,
            formula display, measurement labels.

  static/favicon.ico
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The small icon shown in browser tabs.

  static/logo.svg
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The SVG logo of the application.

  static/wasm/  (folder)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Contains the compiled WebAssembly output.
  Files are auto-generated by "deno task build:wasm".
  DO NOT edit these files manually.
    math_validator.js       â† JavaScript "glue code" to call the WASM
    math_validator.d.ts     â† TypeScript type declarations
    math_validator_bg.wasm  â† The actual compiled Rust binary


================================================================================
  content/  â† MDX LESSON FILES
================================================================================

  content/lesson-demo.mdx
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  An example lesson written in MDX (Markdown + JSX).
  Demonstrates: headings, paragraphs, KaTeX math formulas ($x^2 + y^2 = z^2$),
                code blocks, and custom React/Preact components inside markdown.
  Accessible at: http://localhost:5173/lesson/lesson-demo


================================================================================
  tests/  â† TEST FILES & GOLDEN BASELINES
================================================================================

  tests/golden/  (folder â€” 9 files)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The "source of truth" for what the project should look like.
  If any code changes accidentally break these, deno task verify will FAIL.
  These files are committed to git â€” they change only when you INTENTIONALLY
  run "deno task snapshot:all" to update them.

    css-tokens.txt
      All CSS custom properties from base.css (sorted alphabetically).
      Monitors: Did anyone accidentally delete or rename a CSS variable?

    lib-contracts.txt
      The exported function signatures from every lib/ file.
      Monitors: Did a function get renamed, removed, or change its arguments?

    island-contracts.txt
      The exported component names from every islands/ file.
      Monitors: Did an island component get renamed or removed?

    physics.txt
      41 deterministic math validation results.
      Example: "validate_arithmetic('2+2', 4) â†’ true"
      Monitors: Did the math logic change and produce different results?

    state-flow.log
      5 simulated user interaction sequences.
      Example: "selectTopic(6) â†’ activeTopicData.name = 'Fractions'"
      Monitors: Did the state management logic break?

    ui-titlebar.html    (also: ui-sidebar.html, ui-mathstage.html, ui-theme.html)
      HTML snapshots of each major component.
      Monitors: Did the component's HTML structure change unexpectedly?

  tests/e2e/  (folder â€” 2 files)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  End-to-end tests using Playwright (real browser automation).

    math-validation.spec.ts
      Tests the full validation flow in a real browser:
      Load page â†’ type an answer â†’ click Check â†’ verify result appears.

    navigation.spec.ts
      Tests topic switching:
      Click a topic in Sidebar â†’ verify MathStage shows that topic.


================================================================================
  scripts/  â† THE 7-PILLAR GUARD SYSTEM (Verification)
================================================================================

  These scripts are run as part of "deno task verify".
  They protect the project from silent regressions.

  scripts/snapshot-physics.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Runs 41 math scenarios and saves results to tests/golden/physics.txt.
  Run via: deno task snapshot:physics  (to REGENERATE the baseline)
  Run via: deno task test:rust         (cargo test includes these via Rust)

  scripts/snapshot-ui.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Generates HTML snapshots of TitleBar, Sidebar, MathStage, and Theme.
  Saves to: tests/golden/ui-*.html
  Run via: deno task snapshot:ui

  scripts/snapshot-state.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Simulates 5 user interaction flows and saves the state transitions.
  Saves to: tests/golden/state-flow.log
  Run via: deno task snapshot:state

  scripts/snapshot-css-tokens.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Reads static/css/base.css, extracts all CSS --variables, sorts them.
  In write mode: saves to tests/golden/css-tokens.txt
  In check mode (--check): compares current variables to the saved list.
  If a variable was deleted or renamed â†’ DRIFT DETECTED error.
  Run via: deno task snapshot:css (write) or deno task test:layer4 (check)

  scripts/snapshot-lib-contracts.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Scans all lib/*.ts files and records exported function names.
  Saves to: tests/golden/lib-contracts.txt
  Run via: deno task test:layer2 (check mode)

  scripts/snapshot-island-contracts.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Scans all islands/*.tsx files and records exported component names.
  Saves to: tests/golden/island-contracts.txt
  Run via: deno task test:layer3 (check mode)

  scripts/verify-boundaries.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Enforces the "Trinity Layer" architecture rules:
    â€¢ islands/ must NOT import from routes/
    â€¢ routes/ must NOT import from islands/
    â€¢ lib/ must NOT import from islands/ or routes/
  If a violation is found â†’ BUILD FAILS with a clear error message.
  Run via: deno task test:boundaries

  scripts/verify-snapshots.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Checks that all 9 golden snapshot files exist and are not empty.
  A safety net â€” ensures nobody accidentally deleted a baseline file.
  Run via: the last step in deno task verify

  scripts/bisect-verify.ts
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A helper script for "git bisect" (finding which commit broke something).
  Runs all verifications and exits with code 0 (good) or 1 (bad).
  Usage with git: git bisect run deno task bisect:verify


================================================================================
  docs/  â† DOCUMENTATION FOLDER
================================================================================

  docs/project_overview.txt            â† Conceptual architecture (how layers work)
  docs/file_reference.txt              â† THIS FILE (what every file does)
  docs/anti_logic_drift_principles.txt â† The quality philosophy playbook (86KB)
  docs/TUTORIAL.md                     â† Step-by-step learning guide
  docs/COMMANDS_REFERENCE.md           â† Quick reference for all task commands
  docs/GIT_BISECT_GUIDE.md             â† How to find breaking commits with git bisect
  docs/PROJECT_STRUCTURE_LESSONS.md    â† Lessons on the project structure
  docs/TAGGING_STRATEGY.md             â† Git tagging strategy for releases
  docs/deno-webui-plan.txt             â† Old plan for deno-webui integration
  docs/file.todo                       â† A copy of the project roadmap (reference)


================================================================================
  skills/  â† AI AGENT INSTRUCTION FILES
================================================================================

  These folders contain instructions for AI coding assistants.
  The AI reads these before working on related tasks.

  skills/sovereign-core/SKILL.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Core development patterns for this project.
  Covers: island patterns, signal usage, WASM integration, desktop API.

  skills/fresh-v2/SKILL.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Deep technical knowledge about Fresh 2.x framework.
  Covers: routing, islands, server components, MDX, Vite integration.

  skills/anti-logic-drift/SKILL.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  How to apply the Anti-Logic Drift quality system to this project.
  Covers: snapshot workflow, boundary enforcement, purity testing.

  skills/coding-standards/SKILL.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  The project's coding standards.
  KEY RULE: No file may exceed 800 lines. If it does, split it into modules.
  Also covers: CSS architecture, naming conventions.


================================================================================
  .github/  â† GITHUB AUTOMATION
================================================================================

  .github/copilot-instructions.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Instructions for GitHub Copilot (another AI assistant).
  Contains the same project rules as GEMINI.md but in Copilot's format.

  .github/workflows/  (folder)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  GitHub Actions CI/CD workflows.
  When you push code to GitHub, these run automatically on GitHub's servers.
  They run deno task verify to ensure nothing is broken before merging.


================================================================================
  .agent/  â† AI AGENT WORKFLOW FILES
================================================================================

  .agent/workflows/sovereign-development.md
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  A step-by-step workflow guide for the Antigravity AI agent.
  Tells the AI how to develop features correctly in this project:
  plan â†’ implement â†’ run verify â†’ update snapshots if needed â†’ done.


================================================================================
  .vscode/  â† VSCODE EDITOR SETTINGS
================================================================================

  Settings and skills specifically for the VSCode editor.
  The "skills" subfolder contains VSCode-specific context files
  that power intelligent autocomplete and AI suggestions.


================================================================================
  native/  â† RUST NATIVE WINDOW LIBRARY (LEGACY)
================================================================================

  An older approach to native windowing using Rust FFI (Foreign Function Interface).
  This compiled to a .dll that Deno could call directly.
  The current approach uses the standalone "desktop/" Rust app instead.
  Still present for reference, but not used in the main workflow.


================================================================================
  subjects/  â† EXERCISE CONTENT DATA
================================================================================

  Contains 89 subdirectories of exercise data organized by math subject.
  This is the raw content pipeline for generating the 1,814 .bin exercise files.
  STATUS: Content generation (Phase 7) is still pending.


================================================================================
  HOW ALL FILES CONNECT  (Quick Summary)
================================================================================

  User opens the app
    â†“
  desktop/src/main.rs (Rust) creates the native window
    loads http://localhost:5173 in a WebView
    â†“
  main.ts starts the Deno server
    Fresh reads fresh.gen.ts to discover all routes and islands
    â†“
  routes/_app.tsx wraps every page with HTML + discord.css link
  routes/index.tsx assembles the 4 main islands
    â†“
  islands/TitleBar.tsx    â†’ reads/writes isMaximized signal
  islands/Sidebar.tsx     â†’ reads TOPICS, writes activeTopic signal
  islands/MathStage.tsx   â†’ reads activeTopic, calls exercise-loader, calls WASM
  islands/LessonToc.tsx   â†’ reads lesson headings, handles scroll
    â†“
  lib/state.ts            â†’ all signals live here (the shared state)
  lib/exercise-loader.ts  â†’ fetches and parses .bin exercise files
  lib/wasm-loader.ts      â†’ loads the WASM binary into the browser
    â†“
  static/wasm/*.wasm      â†’ compiled from math-engine/src/lib.rs (Rust)
    â†’ validates student answers, returns JSON result
    â†“
  static/css/base.css     â†’ defines all color variables
  static/discord.css      â†’ imports all CSS modules
    â†’ visual appearance of the entire app


================================================================================
  END OF FILE REFERENCE GUIDE
================================================================================
